---
title: "Kafka Standardization"
description: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è Kafka headers –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Axion Stack"
order: 5
---

# Kafka Standardization

Axion Stack –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Kafka headers –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.

## üìã –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Headers

–í—Å–µ Kafka —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ headers:

- `x-correlation-id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
- `x-causation-id` - ID —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–∑–≤–∞–ª–æ —Ç–µ–∫—É—â–µ–µ
- `x-user-id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `x-project-id` - ID –ø—Ä–æ–µ–∫—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `x-request-id` - ID –∑–∞–ø—Ä–æ—Å–∞ (–æ–±—ã—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å correlation-id)
- `x-timestamp` - –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ headers –∏–∑ RequestMetadata

```typescript
import { createKafkaHeaders } from "@axion/shared";
import type { RequestMetadata } from "@axion/contracts";

const metadata: RequestMetadata = {
  userId: "user-123",
  projectId: "project-456",
  requestId: "req-789",
  timestamp: Date.now(),
};

// –°–æ–∑–¥–∞—Ç—å headers –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
const headers = createKafkaHeaders(metadata);
// {
//   "x-correlation-id": "req-789",
//   "x-causation-id": "req-789",
//   "x-user-id": "user-123",
//   "x-project-id": "project-456",
//   "x-request-id": "req-789",
//   "x-timestamp": "1234567890"
// }

// –° causationId (–∫–æ–≥–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—ã–∑–≤–∞–Ω–æ –¥—Ä—É–≥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º)
const headersWithCausation = createKafkaHeaders(
  metadata,
  "original-message-id"
);
```

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ metadata –∏–∑ headers

```typescript
import { extractMetadataFromHeaders } from "@axion/shared";

// –í MessagePattern handler
@MessagePattern(GRAPH_SERVICE_PATTERNS.CREATE_PROJECT)
async createProject(
  @Payload() data: CreateProjectRequest,
  @Ctx() context: KafkaContext
) {
  // –ò–∑–≤–ª–µ—á—å metadata –∏–∑ Kafka headers
  const kafkaMessage = context.getMessage();
  const headers = kafkaMessage.headers || {};
  const metadata = extractMetadataFromHeaders(headers);

  // metadata —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç userId, projectId, requestId, timestamp
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å metadata –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
}
```

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

```typescript
import {
  getCorrelationIdFromHeaders,
  getUserIdFromHeaders,
  getProjectIdFromHeaders,
} from "@axion/shared";

const correlationId = getCorrelationIdFromHeaders(headers);
const userId = getUserIdFromHeaders(headers);
const projectId = getProjectIdFromHeaders(headers);
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ headers

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `ClientProxy` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, headers –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `RequestMetadata`:

```typescript
// –í —Å–µ—Ä–≤–∏—Å–µ
const response = await firstValueFrom(
  this.graphClient.send(GRAPH_SERVICE_PATTERNS.CREATE_PROJECT, {
    metadata: data.metadata, // RequestMetadata —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç correlationId
    name: "My Project",
  })
);
```

NestJS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `metadata` –≤ Kafka headers –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

## üìù Best Practices

1. **–í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ RequestMetadata** - —ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ correlationId
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ causationId** - –∫–æ–≥–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—ã–∑–≤–∞–Ω–æ –¥—Ä—É–≥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
3. **–õ–æ–≥–∏—Ä—É–π—Ç–µ correlationId** - –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å—ã
4. **–ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ headers –≤–Ω–∏–∑** - –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ correlationId

## üîç –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ flow

```typescript
// 1. HTTP –∑–∞–ø—Ä–æ—Å ‚Üí RequestMetadata —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
@Post("projects")
async createProject(
  @AxionRequestMetadata() metadata: RequestMetadata, // correlationId —É–∂–µ –µ—Å—Ç—å
  @Body() body: CreateProjectRequest
) {
  // 2. –í—ã–∑–æ–≤ –¥—Ä—É–≥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ Kafka
  const response = await firstValueFrom(
    this.codegenClient.send(CODEGEN_SERVICE_PATTERNS.GENERATE_PROJECT, {
      metadata, // correlationId –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
      projectId: body.projectId,
    })
  );

  // 3. –í codegen-service MessagePattern handler
  // metadata –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ Kafka headers
  return this.codegenService.generateProject(data);
}
```

## üõ†Ô∏è –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã

```typescript
import { KAFKA_HEADERS } from "@axion/shared";

KAFKA_HEADERS.CORRELATION_ID; // "x-correlation-id"
KAFKA_HEADERS.CAUSATION_ID; // "x-causation-id"
KAFKA_HEADERS.USER_ID; // "x-user-id"
KAFKA_HEADERS.PROJECT_ID; // "x-project-id"
KAFKA_HEADERS.REQUEST_ID; // "x-request-id"
KAFKA_HEADERS.TIMESTAMP; // "x-timestamp"
```

## üìö –°–º. —Ç–∞–∫–∂–µ

- [Kafka Integration](./KAFKA_INTEGRATION.md) - –±–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Kafka
- [API Reference](./API_REFERENCE.mdx) - HTTP API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Architecture](./ARCHITECTURE.mdx) - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
