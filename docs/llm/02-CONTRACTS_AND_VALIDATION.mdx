---
title: "Contracts & Validation"
description: "Система контрактов и валидации в Axion. Все микросервисы используют Protobuf контракты для типобезопасной коммуникации, а многоуровневая система валидации гарантирует качество сгенерированного кода."
order: 2
---

# Contracts & Validation

## Обзор

Система контрактов и валидации в Axion. Все микросервисы используют Protobuf контракты для типобезопасной коммуникации, а многоуровневая система валидации гарантирует качество сгенерированного кода.

## Контрактная система

**Что такое Protobuf контракты?**
Protobuf (Protocol Buffers) — язык-независимый формат сериализации данных для типобезопасной коммуникации между микросервисами.

**Преимущества Protobuf:**

- Типобезопасность — автоматическая генерация TypeScript типов
- Производительность — более компактный формат чем JSON
- Версионирование — поддержка обратной совместимости
- Валидация — встроенная валидация данных

**Protobuf Contracts в Axion:**
Все межсервисное общение (Kafka для SaaS, HTTP RPC для генерируемых сервисов) использует Protobuf для типобезопасности.

**Автоматическая генерация:**

1. Извлечение из графа — система анализирует edges между сервисами
2. Генерация Protobuf — создаются `.proto` файлы
3. Генерация TypeScript — генерируются типы из `.proto`
4. Валидация — проверка соответствия MessagePattern

## Система валидации

Многоуровневая валидация гарантирует:

- Качество кода — код соответствует стандартам
- Работоспособность — сервисы реально работают
- Типобезопасность — нет ошибок типов
- Соответствие контрактам — все контракты реализованы

**Validation Pipeline (6 уровней):**

1. **Structural Validation**
   - Проверка обязательных файлов из Blueprint структуры
   - Правильная структура директорий
   - Соответствие файлов требованиям Blueprint

2. **Contract Validation**
   - Все MessagePattern имеют соответствующие Protobuf контракты
   - Все контракты имеют реализованные MessagePattern
   - Соответствие типов в контрактах и коде

3. **TypeScript Validation**
   - Корректность TypeScript типов
   - Отсутствие ошибок компиляции
   - Выполняется `tsc --noEmit`

4. **Build Validation**
   - Код компилируется и собирается
   - Выполняется `bun run build`

5. **Health Check Validation**
   - Сервис запускается в Docker
   - Health endpoint отвечает
   - Все MessagePattern доступны

6. **Contract Discovery Validation**
   - Все зарегистрированные MessagePattern соответствуют контрактам
   - Нет неиспользуемых контрактов
   - Валидация при запуске сервиса

**Результат валидации:**

- ✅ Успех — сервис готов к деплою, статус `validated`
- ❌ Ошибка — статус `error`, список ошибок для исправления

## Отказоустойчивость

Каждый сервис должен реализовывать паттерны отказоустойчивости:

- **Retry** — повторные попытки с exponential backoff
- **Circuit Breaker** — защита от каскадных сбоев
- **Timeout** — ограничение времени ожидания
- **Fallback** — альтернативные стратегии при сбоях
- **Graceful Shutdown** — корректное завершение работы
- **Health Checks** — мониторинг здоровья сервиса
