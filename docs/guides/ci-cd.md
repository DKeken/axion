---
title: "CI/CD и Деплой"
description: "Пайплайны непрерывной интеграции для платформы и пользовательских проектов."
---

# CI/CD и Деплой

В Axion существует два независимых контура CI/CD: один для разработки самой платформы, другой — для автоматического деплоя проектов пользователей.

## 1. Platform CI (Разработка Axion)

Используется для проверки кода монорепозитория Axion.
*   **Инструмент**: GitHub Actions + Turborepo.
*   **Caching**: Turborepo Remote Cache для ускорения сборки.
*   **Этапы**:
    1.  `lint`: Проверка стиля кода.
    2.  `type-check`: Компиляция TypeScript.
    3.  `test`: Запуск Unit и Contract тестов.
    4.  `build`: Сборка Docker-образов сервисов Control Plane.

## 2. User Project CD (Деплой проектов)

Этот пайплайн запускается, когда пользователь нажимает "Deploy" в интерфейсе. Он полностью управляется сервисами Axion.

### Этапы деплоя

1.  **Генерация (Codegen Service)**
    *   Актуализация кода на основе текущего графа.
    *   Запуск валидаторов (Structure, Contracts, Types).

2.  **Сборка (Build Worker)**
    *   Запуск изолированного Docker-контейнера для сборки.
    *   Сборка оптимизированного образа (Alpine Linux).
    *   Пуш образа во внутренний Docker Registry (`registry.axion.local`).

3.  **Доставка (Deployment Service)**
    *   Создание манифеста развертывания (Docker Stack).
    *   Отправка команды `stack.deploy` на Runner Agent целевого сервера через Kafka.

4.  **Применение (Runner Agent)**
    *   Агент скачивает новый образ.
    *   Выполняет Rolling Update сервисов.
    *   Отслеживает Health Checks. При ошибке выполняется автоматический откат (Rollback).

## Стратегии обновления

*   **Rolling Update** (По умолчанию):
    Постепенная замена инстансов (start new -> wait health -> stop old). Обеспечивает Zero Downtime.
*   **Recreate**:
    Остановка всех старых контейнеров перед запуском новых. Используется, когда схема БД меняется несовместимым образом и одновременная работа двух версий невозможна.
