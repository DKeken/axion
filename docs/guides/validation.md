---
title: "Система Валидации"
description: "Пайплайн проверки качества сгенерированного кода."
---

# Система Валидации

Axion гарантирует, что сгенерированный код не только синтаксически верен, но и работоспособен. Для этого используется 6-уровневый пайплайн валидации (Validation Pipeline).

## Уровни проверки

Валидация выполняется последовательно. Ошибка на любом уровне останавливает процесс.

### 1. Structural Validation (Структурная)

Проверяет целостность файловой структуры проекта.

- **Проверка**: Наличие всех обязательных файлов (`package.json`, `Dockerfile`, `.env.example`).
- **Инструмент**: Внутренний сканер файловой системы.

### 2. Contract Validation (Контрактная)

Проверяет соответствие кода Protobuf-контрактам.

- **Проверка**: Парсинг AST (Abstract Syntax Tree) TypeScript кода. Убеждается, что для каждого `rpc` метода в `.proto` существует реализация обработчика в коде.
- **Инструмент**: `ts-morph` для анализа AST.

### 3. TypeScript Validation (Типизация)

Проверяет отсутствие ошибок типов.

- **Проверка**: Запуск компилятора TypeScript в режиме проверки.
- **Команда**: `tsc --noEmit --skipLibCheck`.

### 4. Build Validation (Сборка)

Проверяет собираемость проекта.

- **Проверка**: Попытка скомпилировать проект в JavaScript (или бинарник).
- **Команда**: `bun run build`.

### 5. Health Check (Запуск)

Проверяет запуск сервиса в изолированном контейнере.

- **Проверка**: Сервис запускается, и выполняется HTTP запрос к `/health`.
- **Критерий**: Ответ `200 OK` в течение 30 секунд.

### 6. Contract Discovery (Связность)

Проверяет интеграцию между сервисами.

- **Проверка**: Если Сервис А вызывает Сервис Б, валидатор проверяет, что Сервис Б действительно реализует вызываемый метод.
- **Инструмент**: Анализ графа зависимостей вызовов.

## Реализация

Валидатор запускается как часть CI/CD пайплайна перед деплоем.

```typescript
// Псевдокод пайплайна
async function validateProject(projectId: string) {
  await validators.structure.run(projectId);
  await validators.contracts.run(projectId);
  await validators.typescript.run(projectId);
  await validators.build.run(projectId);

  // Запуск в песочнице для runtime-проверок
  await sandbox.start(projectId);
  try {
    await validators.health.run(projectId);
    await validators.discovery.run(projectId);
  } finally {
    await sandbox.stop(projectId);
  }
}
```

## Метрики и Отчеты

Результаты валидации сохраняются в базу данных. Пользователь видит детальный отчет в UI:

- ✅ Уровень пройден.
- ❌ Ошибка (с указанием файла и строки).
- ⚠️ Предупреждение (некритичная проблема, например, неиспользуемый метод).
