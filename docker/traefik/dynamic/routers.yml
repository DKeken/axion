# Auto-generated from docker/services.config.ts
# DO NOT EDIT - run: bun run docker:generate-traefik-config
# Mode: dev

http:
  routers:
    traefik:
      rule: Host(`traefik.localhost`)
      entryPoints:
        - web
      service: api@internal
    auth:
      rule: PathPrefix(`/api/auth`)
      entryPoints:
        - web
      service: auth-service
      middlewares:
        - cors
    auth-secure:
      rule: PathPrefix(`/api/auth`)
      entryPoints:
        - websecure
      service: auth-service
      middlewares:
        - cors
    graph-connect:
      rule: PathPrefix(`/axion.graph.`) || PathPrefix(`/axion.graph/`)
      entryPoints:
        - web
      service: graph-service
      middlewares:
        - cors-connect
    graph:
      rule: PathPrefix(`/api/v1/graph`)
      entryPoints:
        - web
      service: graph-service
      middlewares:
        - cors
        - graph-stripprefix
    graph-ws:
      rule: PathPrefix(`/api/v1/graph`)
      entryPoints:
        - web
      service: graph-service
      middlewares:
        - cors
        - graph-stripprefix
        - graph-ws-headers
    graph-secure:
      rule: PathPrefix(`/api/v1/graph`)
      entryPoints:
        - websecure
      service: graph-service
      middlewares:
        - cors
        - graph-stripprefix
    codegen-connect:
      rule: PathPrefix(`/axion.codegen.`) || PathPrefix(`/axion.codegen/`)
      entryPoints:
        - web
      service: codegen-service
      middlewares:
        - cors-connect
    codegen:
      rule: PathPrefix(`/api/v1/codegen`)
      entryPoints:
        - web
      service: codegen-service
      middlewares:
        - cors
        - codegen-stripprefix
    codegen-secure:
      rule: PathPrefix(`/api/v1/codegen`)
      entryPoints:
        - websecure
      service: codegen-service
      middlewares:
        - cors
        - codegen-stripprefix
    deployment-connect:
      rule: PathPrefix(`/axion.deployment.`) || PathPrefix(`/axion.deployment/`)
      entryPoints:
        - web
      service: deployment-service
      middlewares:
        - cors-connect
    deployment:
      rule: PathPrefix(`/api/v1/deployment`)
      entryPoints:
        - web
      service: deployment-service
      middlewares:
        - cors
        - deployment-stripprefix
    deployment-secure:
      rule: PathPrefix(`/api/v1/deployment`)
      entryPoints:
        - websecure
      service: deployment-service
      middlewares:
        - cors
        - deployment-stripprefix
    infrastructure-connect:
      rule: >-
        PathPrefix(`/axion.infrastructure.`) ||
        PathPrefix(`/axion.infrastructure/`)
      entryPoints:
        - web
      service: infrastructure-service
      middlewares:
        - cors-connect
    infrastructure:
      rule: PathPrefix(`/api/v1/infrastructure`)
      entryPoints:
        - web
      service: infrastructure-service
      middlewares:
        - cors
        - infrastructure-stripprefix
    infrastructure-secure:
      rule: PathPrefix(`/api/v1/infrastructure`)
      entryPoints:
        - websecure
      service: infrastructure-service
      middlewares:
        - cors
        - infrastructure-stripprefix
    billing-connect:
      rule: PathPrefix(`/axion.billing.`) || PathPrefix(`/axion.billing/`)
      entryPoints:
        - web
      service: billing-service
      middlewares:
        - cors-connect
    billing:
      rule: PathPrefix(`/api/v1/billing`)
      entryPoints:
        - web
      service: billing-service
      middlewares:
        - cors
        - billing-stripprefix
    billing-secure:
      rule: PathPrefix(`/api/v1/billing`)
      entryPoints:
        - websecure
      service: billing-service
      middlewares:
        - cors
        - billing-stripprefix
  services:
    auth-service:
      loadBalancer:
        servers:
          - url: http://host.docker.internal:3010
    graph-service:
      loadBalancer:
        servers:
          - url: http://host.docker.internal:3001
    codegen-service:
      loadBalancer:
        servers:
          - url: http://host.docker.internal:3002
    deployment-service:
      loadBalancer:
        servers:
          - url: http://host.docker.internal:3005
    infrastructure-service:
      loadBalancer:
        servers:
          - url: http://host.docker.internal:3004
    billing-service:
      loadBalancer:
        servers:
          - url: http://host.docker.internal:3006
  middlewares:
    cors:
      headers:
        accessControlAllowCredentials: true
        accessControlAllowMethods:
          - GET
          - POST
          - PUT
          - PATCH
          - DELETE
          - OPTIONS
        accessControlAllowHeaders:
          - Authorization
          - Content-Type
          - Accept
          - X-Requested-With
          - X-Correlation-ID
        accessControlExposeHeaders:
          - X-Correlation-ID
        accessControlMaxAge: 86400
        addVaryHeader: true
        accessControlAllowOriginList:
          - http://localhost:3000
          - http://localhost:3001
          - http://127.0.0.1:3000
          - http://127.0.0.1:3001
        accessControlAllowOriginListRegex:
          - ^https?://localhost(?::\\d+)?$
          - ^https?://127\\.0\\.0\\.1(?::\\d+)?$
    cors-connect:
      headers:
        accessControlAllowCredentials: true
        accessControlAllowMethods:
          - POST
          - GET
          - OPTIONS
        accessControlAllowHeaders:
          - Authorization
          - Content-Type
          - Accept
          - Connect-Protocol-Version
          - Connect-Timeout-Ms
          - X-Requested-With
          - X-Correlation-ID
        accessControlExposeHeaders:
          - Connect-Protocol-Version
          - Connect-Timeout-Ms
          - X-Correlation-ID
        accessControlMaxAge: 86400
        addVaryHeader: true
        accessControlAllowOriginList:
          - http://localhost:3000
          - http://localhost:3001
          - http://127.0.0.1:3000
          - http://127.0.0.1:3001
          - http://traefik.localhost
          - https://traefik.localhost
        accessControlAllowOriginListRegex:
          - ^https?://localhost(?::\\d+)?$
          - ^https?://127\\.0\\.0\\.1(?::\\d+)?$
          - ^https?://traefik\\.localhost(?::\\d+)?$
          - ^https?://192\\.168\\.\\d+\\.\\d+(?::\\d+)?$
          - ^https?://10\\.\\d+\\.\\d+\\.\\d+(?::\\d+)?$
          - ^https?://172\\.(1[6-9]|2\\d|3[0-1])\\.\\d+\\.\\d+(?::\\d+)?$
    graph-stripprefix:
      stripPrefix:
        prefixes:
          - /api/v1/graph
    graph-ws-headers:
      headers:
        customRequestHeaders:
          Upgrade: websocket
    codegen-stripprefix:
      stripPrefix:
        prefixes:
          - /api/v1/codegen
    deployment-stripprefix:
      stripPrefix:
        prefixes:
          - /api/v1/deployment
    infrastructure-stripprefix:
      stripPrefix:
        prefixes:
          - /api/v1/infrastructure
    billing-stripprefix:
      stripPrefix:
        prefixes:
          - /api/v1/billing
