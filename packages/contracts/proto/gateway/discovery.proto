syntax = "proto3";

package axion.gateway;

import "common/common.proto";
import "gateway/enums.proto";

// Service Discovery messages
message RegisterServiceRequest {
  string service_name = 1;
  ServiceInstance instance = 2;
}

message UnregisterServiceRequest {
  string service_name = 1;
  string instance_id = 2;
}

message HeartbeatRequest {
  string service_name = 1;
  string instance_id = 2;
}

message DiscoverServiceRequest {
  string service_name = 1;
  LoadBalancingStrategy strategy = 2; // 'round-robin', 'least-connections'
}

message ServiceInstance {
  string id = 1;
  string host = 2;
  int32 port = 3;
  axion.common.ProtocolType protocol = 4;
  map<string, string> metadata = 5;
  int64 registered_at = 6;
  int64 last_heartbeat = 7;
}

message ServiceInstanceResponse {
  axion.common.Status status = 1;
  oneof result {
    axion.common.Error error = 2;
    ServiceInstance instance = 3;
  }
}

message ListServicesRequest {
  axion.common.RequestMetadata metadata = 1;
}

message ListServicesResponse {
  axion.common.Status status = 1;
  oneof result {
    axion.common.Error error = 2;
    ListServicesData data = 3;
  }
}

message ListServicesData {
  repeated ServiceInfo services = 1;
}

message ServiceInfo {
  string name = 1;
  repeated ServiceInstance instances = 2;
  int32 instances_count = 3;
}
